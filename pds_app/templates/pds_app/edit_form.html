{% extends 'pds_app/dashboard.html' %}

{% block content %}

<div class="edit-form-container">
    {% if creating %}
        <h2>Create Form</h2>
    {% else %}
        <h2>Edit Form: {{ form_instance.name }}</h2>
    {% endif %}
    
    <form method="post" class="general-form" id="general-form" enctype="multipart/form-data">
        {% csrf_token %}
        
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
        {% endif %}

        <h3 style="text-align:center;">Form</h3>
        <fieldset>
            <legend>Form Name</legend>
            <div class="form-row">
                <input required name="form_name" type="text" value="{{ form_instance.name }}"/>
            </div>
        </fieldset>

        <!-- ID Photo Section -->
        <fieldset>
            <legend>2x2 ID Photo</legend>
            <div class="id-photo-section">
                <div class="photo-preview">
                    {% if form_instance.id_photo and form_instance.id_photo.name %}
                        <img src="{{ form_instance.id_photo.url }}" alt="ID Photo" class="id-photo-img" id="photoPreview">
                        <div class="photo-actions">
                            <button type="button" class="btn-change-photo" onclick="document.getElementById('id_photo_input').click()">
                                Change Photo
                            </button>
                            <button type="button" class="btn-remove-photo" onclick="removePhoto()">
                                Remove Photo
                            </button>
                        </div>
                    {% else %}
                        <div class="photo-placeholder" id="photoPlaceholder">
                            <svg width="64" height="64" fill="#ccc" viewBox="0 0 16 16">
                                <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                            </svg>
                            <p>No photo uploaded</p>
                            <button type="button" class="btn-upload-photo" onclick="document.getElementById('id_photo_input').click()">
                                Upload Photo
                            </button>
                        </div>
                        <img src="" alt="ID Photo" class="id-photo-img" id="photoPreview" style="display: none;">
                    {% endif %}
                </div>
                
                <div class="photo-info">
                    <p><strong>Photo Requirements:</strong></p>
                    <ul>
                        <li>Format: JPG or PNG</li>
                        <li>Size: Maximum 5MB</li>
                        <li>Recommended: 2x2 inches (600x600 pixels)</li>
                        <li>Recent photo with white background</li>
                        <li>Face clearly visible</li>
                    </ul>
                    
                    <input 
                        type="file" 
                        id="id_photo_input" 
                        name="id_photo" 
                        accept="image/jpeg,image/jpg,image/png"
                        style="display: none;"
                        onchange="previewPhoto(event)"
                    >
                    <input type="hidden" name="remove_photo" id="remove_photo_input" value="false">
                </div>
            </div>
        </fieldset>
            
        <h3 style="text-align:center;">Personal Information</h3>
        
        <fieldset>
            <legend>Personal Details</legend>
            <div class="form-row">
                <label for="id_surname">Surname:</label>
                {{ personal_form.surname }}
            </div>
            <div class="form-row">
                <label for="id_firstname">First Name:</label>
                {{ personal_form.firstname }}
            </div>
            <div class="form-row">
                <label for="id_middlename">Middle Name:</label>
                {{ personal_form.middlename }}
            </div>
            <div class="form-row">
                <label for="id_date_of_birth">Date of Birth:</label>
                {{ personal_form.date_of_birth }}
            </div>
            <div class="form-row">
                <label for="id_place_of_birth">Place of Birth:</label>
                {{ personal_form.place_of_birth }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Physical Details</legend>
            <div class="form-row">
                <label for="id_sex">Sex:</label>
                {{ personal_form.sex }}
            </div>
            <div class="form-row">
                <label for="id_civil_status">Civil Status:</label>
                {{ personal_form.civil_status }}
            </div>
            <div class="form-row">
                <label for="id_height">Height (cm):</label>
                {{ personal_form.height }}
            </div>
            <div class="form-row">
                <label for="id_weight">Weight (kg):</label>
                {{ personal_form.weight }}
            </div>
            <div class="form-row">
                <label for="id_blood_type">Blood Type:</label>
                {{ personal_form.blood_type }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Contact Information</legend>
            <div class="form-row">
                <label for="id_residential_address">Residential Address:</label>
                {{ personal_form.residential_address }}
            </div>
            <div class="form-row">
                <label for="id_residential_zip_code">Residential Zip Code:</label>
                {{ personal_form.residential_zip_code }}
            </div>
            <div class="form-row">
                <label for="id_permanent_address">Permanent Address:</label>
                {{ personal_form.permanent_address }}
            </div>
            <div class="form-row">
                <label for="id_permanent_zip_code">Permanent Zip Code:</label>
                {{ personal_form.permanent_zip_code }}
            </div>
            <div class="form-row">
                <label for="id_telephone_no">Telephone Number:</label>
                {{ personal_form.telephone_no }}
            </div>
            <div class="form-row">
                <label for="id_mobile_no">Mobile Number:</label>
                {{ personal_form.mobile_no }}
            </div>
            <div class="form-row">
                <label for="id_email_address">Email Address:</label>
                {{ personal_form.email_address }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Government IDs</legend>
            <div class="form-row">
                <label for="id_gsis">GSIS Number:</label>
                {{ personal_form.gsis }}
            </div>
            <div class="form-row">
                <label for="id_pag_ibig">Pag-IBIG Number:</label>
                {{ personal_form.pag_ibig }}
            </div>
            <div class="form-row">
                <label for="id_philhealth">PhilHealth Number:</label>
                {{ personal_form.philhealth }}
            </div>
            <div class="form-row">
                <label for="id_sss_no">SSS Number:</label>
                {{ personal_form.sss_no }}
            </div>
            <div class="form-row">
                <label for="id_tin_no">TIN Number:</label>
                {{ personal_form.tin_no }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Other Information</legend>
            <div class="form-row">
                <label for="id_citizenship">Citizenship:</label>
                {{ personal_form.citizenship }}
            </div>
            <div class="form-row">
                <label for="id_agent_employee_number">Agent Employee Number:</label>
                {{ personal_form.agent_employee_number }}
            </div>
        </fieldset>

       
        <h3 style="text-align:center;">Family Background</h3>
        
        <fieldset>
            <legend>Spouse Information</legend>
            <div class="form-row">
                <label for="id_spouse_surname">Spouse's Surname:</label>
                {{ family_form.spouse_surname }}
            </div>
            <div class="form-row">
                <label for="id_spouse_firstname">Spouse's First Name:</label>
                {{ family_form.spouse_firstname }}
            </div>
            <div class="form-row">
                <label for="id_spouse_middlename">Spouse's Middle Name:</label>
                {{ family_form.spouse_middlename }}
            </div>
            <div class="form-row">
                <label for="id_spouse_name_extension">Spouse's Name Extension:</label>
                {{ family_form.spouse_name_extension }}
            </div>
            <div class="form-row">
                <label for="id_spouse_occupation">Spouse's Occupation:</label>
                {{ family_form.spouse_occupation }}
            </div>
            <div class="form-row">
                <label for="id_spouse_employer_business_name">Employer/Business Name:</label>
                {{ family_form.spouse_employer_business_name }}
            </div>
            <div class="form-row">
                <label for="id_spouse_business_address">Business Address:</label>
                {{ family_form.spouse_business_address }}
            </div>
            <div class="form-row">
                <label for="id_spouse_telephone_no">Telephone Number:</label>
                {{ family_form.spouse_telephone_no }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Children Information</legend>
            <div class="form-row">
                {{ family_form.children}}
            </div>
        </fieldset>
        
        <fieldset>
            <legend>Parents' Information</legend>
            <h3>Father's Information</h3>
            <div class="form-row">
                <label for="id_father_surname">Father's Surname:</label>
                {{ family_form.father_surname }}
            </div>
            <div class="form-row">
                <label for="id_father_firstname">Father's First Name:</label>
                {{ family_form.father_firstname }}
            </div>
            <div class="form-row">
                <label for="id_father_middlename">Father's Middle Name:</label>
                {{ family_form.father_middlename }}
            </div>
            <div class="form-row">
                <label for="id_father_name_extension">Father's Name Extension:</label>
                {{ family_form.father_name_extension }}
            </div>

            <h3>Mother's Information</h3>
            <div class="form-row">
                <label for="id_mother_maiden_lastname">Mother's Maiden Last Name:</label>
                {{ family_form.mother_maiden_lastname }}
            </div>
            <div class="form-row">
                <label for="id_mother_firstname">Mother's First Name:</label>
                {{ family_form.mother_firstname }}
            </div>
            <div class="form-row">
                <label for="id_mother_middlename">Mother's Middle Name:</label>
                {{ family_form.mother_middlename }}
            </div>
        </fieldset>

        

       
        <h3 style="text-align:center;">Other Information</h3>
        
        <fieldset>
            <legend>Relatives by Consanguinity or Affinity</legend>
            <div class="form-row">
                <label>Within Third Degree:</label>
                {{ other_form.with_third_degree }}
            </div>
            <div class="form-row">
                <label>Within Fourth Degree:</label>
                {{ other_form.with_fourth_degree }}
            </div>
            <div class="form-row">
                <label>Details (if any):</label>
                {{ other_form.fourth_degree_details }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Administrative and Criminal Offenses</legend>
            <div class="form-row">
                <label>Administrative Offense:</label>
                {{ other_form.offense }}
            </div>
            <div class="form-row">
                <label>Details:</label>
                {{ other_form.offense_details }}
            </div>
            <div class="form-row">
                <label>Criminally Charged:</label>
                {{ other_form.criminal }}
            </div>
            <div class="form-row">
                <label>Details:</label>
                {{ other_form.criminal_details }}
            </div>
            <div class="form-row">
                <label>Date of Criminal Charge:</label>
                {{ other_form.criminal_date }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Conviction</legend>
            <div class="form-row">
                <label>Convicted of Crime:</label>
                {{ other_form.convicted }}
            </div>
            <div class="form-row">
                <label>Details:</label>
                {{ other_form.convicted_details }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Service Separation</legend>
            <div class="form-row">
                <label>Separated from Service:</label>
                {{ other_form.sep_service }}
            </div>
            <div class="form-row">
                <label>Details:</label>
                {{ other_form.sep_service_details }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Election-Related Questions</legend>
            <div class="form-row">
                <label>Candidate in Election:</label>
                {{ other_form.candidate }}
            </div>
            <div class="form-row">
                <label>Details:</label>
                {{ other_form.candidate_details }}
            </div>
            <div class="form-row">
                <label>Resigned for Campaign:</label>
                {{ other_form.resign_candid }}
            </div>
            <div class="form-row">
                <label>Details:</label>
                {{ other_form.resign_candid_details }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Immigration or Permanent Residency</legend>
            <div class="form-row">
                <label>Immigrant/Permanent Resident:</label>
                {{ other_form.immigrant_status }}
            </div>
            <div class="form-row">
                <label>Details:</label>
                {{ other_form.immigrant_details }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Membership and Status</legend>
            <div class="form-row">
                <label>Member of Indigenous Group:</label>
                {{ other_form.indigenous_group_member }}
            </div>
            <div class="form-row">
                <label>Person with Disability:</label>
                {{ other_form.disability_status }}
            </div>
            <div class="form-row">
                <label>Solo Parent:</label>
                {{ other_form.solo_parent_status }}
            </div>
        </fieldset>

        <fieldset>
            <legend>References</legend>
            <div class="form-row">
                {{ other_form.references }}
            </div>
        </fieldset>

        <fieldset>
            <legend>Government Issued ID</legend>
            <div class="form-row">
                <label>ID Type:</label>
                {{ other_form.government_id }}
            </div>
            <div class="form-row">
                <label>ID Number:</label>
                {{ other_form.government_id_number }}
            </div>
            <div class="form-row">
                <label>Issue Date:</label>
                {{ other_form.id_issue_date }}
            </div>
            <div class="form-row">
                <label>Issue Place:</label>
                {{ other_form.id_issue_place }}
            </div>
        </fieldset>
        

        
        <h3 style="text-align:center;">Educational Background</h3>
        
        
        <table class="main-table">
            <thead>
                <tr>
                    <th class="main-table-header">Level</th>
                    <th class="main-table-header">Name of School</th>
                    <th class="main-table-header">Basic Ed/Degree/Course</th>
                    <th class="main-table-header">Period of Attendance (From)</th>
                    <th class="main-table-header">Period of Attendance (To)</th>
                    <th class="main-table-header">Highest Level/Units Earned</th>
                    <th class="main-table-header">Year Graduated</th>
                    <th class="main-table-header">Scholarship/Honors Received</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="educational-level">Elementary</td>
                    <td>{{ education_form.elementary_name }}</td>
                    <td>{{ education_form.elementary_degree_course }}</td>
                    <td>{{ education_form.elementary_period_from }}</td>
                    <td>{{ education_form.elementary_period_to }}</td>
                    <td>{{ education_form.elementary_highest_level_units }}</td>
                    <td>{{ education_form.elementary_year_graduated }}</td>
                    <td>{{ education_form.elementary_honors }}</td>
                </tr>
                <tr>
                    <td class="educational-level">Secondary</td>
                    <td>{{ education_form.secondary_name }}</td>
                    <td>{{ education_form.secondary_degree_course }}</td>
                    <td>{{ education_form.secondary_period_from }}</td>
                    <td>{{ education_form.secondary_period_to }}</td>
                    <td>{{ education_form.secondary_highest_level_units }}</td>
                    <td>{{ education_form.secondary_year_graduated }}</td>
                    <td>{{ education_form.secondary_honors }}</td>
                </tr>
                <tr>
                    <td class="educational-level">Vocational/Trade Course</td>
                    <td>{{ education_form.vocational_name }}</td>
                    <td>{{ education_form.vocational_degree_course }}</td>
                    <td>{{ education_form.vocational_period_from }}</td>
                    <td>{{ education_form.vocational_period_to }}</td>
                    <td>{{ education_form.vocational_highest_level_units }}</td>
                    <td>{{ education_form.vocational_year_graduated }}</td>
                    <td>{{ education_form.vocational_honors }}</td>
                </tr>
                <tr>
                    <td class="educational-level">College</td>
                    <td>{{ education_form.college_name }}</td>
                    <td>{{ education_form.college_degree_course }}</td>
                    <td>{{ education_form.college_period_from }}</td>
                    <td>{{ education_form.college_period_to }}</td>
                    <td>{{ education_form.college_highest_level_units }}</td>
                    <td>{{ education_form.college_year_graduated }}</td>
                    <td>{{ education_form.college_honors }}</td>
                </tr>
                <tr>
                    <td class="educational-level">Graduate Studies</td>
                    <td>{{ education_form.graduate_name }}</td>
                    <td>{{ education_form.graduate_degree_course }}</td>
                    <td>{{ education_form.graduate_period_from }}</td>
                    <td>{{ education_form.graduate_period_to }}</td>
                    <td>{{ education_form.graduate_highest_level_units }}</td>
                    <td>{{ education_form.graduate_year_graduated }}</td>
                    <td>{{ education_form.graduate_honors }}</td>
                </tr>
            </tbody>
        </table>
        

       
        <h3 style="text-align:center;">Civil Service Eligibility</h3>

        
        <table id="eligibility-table" class="main-table">
            <thead>
                <tr>
                    <th class="main-table-header">Career Service/Eligibility</th>
                    <th class="main-table-header">Rating</th>
                    <th class="main-table-header">Date of Examination/Conferment</th>
                    <th class="main-table-header">Place of Examination/Conferment</th>
                    <th class="main-table-header">License Number</th>
                    <th class="main-table-header">License Validity</th>
                    <th class="main-table-header">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for eligibility in form_instance.civil_service.all %}
                <tr>
                    <td><input type="text" name="career_service[]" value="{{ eligibility.career_service }}"></td>
                    <td><input type="number" name="rating[]" value="{{ eligibility.rating }}" step="0.01"></td>
                    <td><input type="date" style="cursor:pointer" name="exam_date[]" value="{{ eligibility.exam_date|date:'Y-m-d' }}"></td>
                    <td><input type="text" name="exam_place[]" value="{{ eligibility.exam_place }}"></td>
                    <td><input type="text" name="license_number[]" value="{{ eligibility.license_number }}"></td>
                    <td><input type="date" style="cursor:pointer" name="license_validity[]" value="{{ eligibility.license_validity|date:'Y-m-d' }}"></td>
                    
                </tr>
                {% empty %}
                <tr>
                    <td><input type="text" name="career_service[]" placeholder="Career Service/Eligibility"></td>
                    <td><input type="number" name="rating[]" step="0.01" placeholder="Rating"></td>
                    <td><input type="date" style="cursor:pointer" name="exam_date[]"></td>
                    <td><input type="text" name="exam_place[]" placeholder="Place of Examination/Conferment"></td>
                    <td><input type="text" name="license_number[]" placeholder="License Number"></td>
                    <td><input type="date" style="cursor:pointer" name="license_validity[]"></td>
                    
                </tr>
                {% endfor %}
                
            </tbody>
        </table>
        <button type="button" class="add-row-btn" onclick="addCivilServiceRow()">Add Row</button>
        

        
        <h3 style="text-align:center;">Work Experience</h3>

        
        <table id="work-experience-table" class="main-table">
            <thead>
                <tr>
                    <th class="main-table-header">From</th>
                    <th class="main-table-header">To</th>
                    <th class="main-table-header">Position Title</th>
                    <th class="main-table-header">Department/Agency/Office/Company</th>
                    <th class="main-table-header">Monthly Salary</th>
                    <th class="main-table-header">Salary Grade & STEP</th>
                    <th class="main-table-header">Status of Appointment</th>
                    <th class="main-table-header">Govt Service (Y/N)</th>
                    <th class="main-table-header">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for experience in form_instance.work_experience.all %}
                <tr>
                    <td><input type="date" style="cursor:pointer" name="work_from_date[]" value="{{ experience.from_date|date:'Y-m-d' }}"></td>
                    <td><input type="date" style="cursor:pointer" name="work_to_date[]" value="{{ experience.to_date|date:'Y-m-d' }}"></td>
                    <td><input type="text" name="work_position_title[]" value="{{ experience.position_title }}"></td>
                    <td><input type="text" name="work_department[]" value="{{ experience.department }}"></td>
                    <td><input type="number" name="work_monthly_salary[]" value="{{ experience.monthly_salary }}"></td>
                    <td><input type="text" name="work_salary_grade[]" value="{{ experience.salary_grade }}"></td>
                    <td><input type="text" name="work_status[]" value="{{ experience.status_of_appointment }}"></td>
                    <td>
                        <select name="work_govt_service[]">
                            <option value="Y" {% if experience.govt_service == 'Y' %}selected{% endif %}>Yes</option>
                            <option value="N" {% if experience.govt_service == 'N' %}selected{% endif %}>No</option>
                        </select>
                    </td>
                    
                </tr>
                {% empty %}
                <tr>
                    <td><input type="date" style="cursor:pointer" name="work_from_date[]"></td>
                    <td><input type="date" style="cursor:pointer" name="work_to_date[]"></td>
                    <td><input type="text" name="work_position_title[]" placeholder="Position Title"></td>
                    <td><input type="text" name="work_department[]" placeholder="Department/Agency/Office/Company"></td>
                    <td><input type="number" name="work_monthly_salary[]" placeholder="Monthly Salary"></td>
                    <td><input type="text" name="work_salary_grade[]" placeholder="Salary Grade & STEP"></td>
                    <td><input type="text" name="work_status[]" placeholder="Status of Appointment"></td>
                    <td>
                        <select name="work_govt_service[]">
                            <option value="Y">Yes</option>
                            <option value="N">No</option>
                        </select>
                    </td>
                </tr>
                {% endfor %}
                
            </tbody>
        </table>
        <button type="button" class="add-row-btn" onclick="addWorkExperienceRow()">Add Row</button>
        

        <h3 style="text-align:center;">Voluntary Work</h3>

        
        <table id="voluntary-work-table" class="main-table">
            <thead>
                <tr>
                    <th class="main-table-header">Name and Address of Organization</th>
                    <th class="main-table-header">From</th>
                    <th class="main-table-header">To</th>
                    <th class="main-table-header">Number of Hours</th>
                    <th class="main-table-header">Position/Nature of Work</th>
                    <th class="main-table-header">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for work in form_instance.voluntary_work.all %}
                <tr>
                    <td><input type="text" name="voluntary_org[]" value="{{ work.organization_name }}"></td>
                    <td><input type="date" style="cursor:pointer" name="voluntary_from[]" value="{{ work.from_date|date:'Y-m-d' }}"></td>
                    <td><input type="date" style="cursor:pointer" name="voluntary_to[]" value="{{ work.to_date|date:'Y-m-d' }}"></td>
                    <td><input type="number" name="voluntary_hours[]" value="{{ work.number_of_hours }}"></td>
                    <td><input type="text" name="voluntary_nature[]" value="{{ work.nature_of_work }}"></td>
                </tr>
                {% empty %}
                <tr>
                    <td><input type="text" name="voluntary_org[]" placeholder="Name and Address of Organization"></td>
                    <td><input type="date" style="cursor:pointer" name="voluntary_from[]"></td>
                    <td><input type="date" style="cursor:pointer" name="voluntary_to[]"></td>
                    <td><input type="number" name="voluntary_hours[]" placeholder="Number of Hours"></td>
                    <td><input type="text" name="voluntary_nature[]" placeholder="Position/Nature of Work"></td>
                </tr>
                {% endfor %}
                
            </tbody>
        </table>
        <button type="button" class="add-row-btn" onclick="addVoluntaryWorkRow()">Add Row</button>
        

       
        <h3 style="text-align:center;">Learning and Development</h3>

        <table id="learning-development-table" class="main-table">
            <thead>
                <tr>
                    <th class="main-table-header">Title</th>
                    <th class="main-table-header">From</th>
                    <th class="main-table-header">To</th>
                    <th class="main-table-header">Number of Hours</th>
                    <th class="main-table-header">Type of LD</th>
                    <th class="main-table-header">Conducted/Sponsored By</th>
                    <th class="main-table-header">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for learning in form_instance.learning_development.all %}
                <tr>
                    <td><input type="text" name="learning_title[]" value="{{ learning.title }}"></td>
                    <td><input type="date" style="cursor:pointer" name="learning_from[]" value="{{ learning.from_date|date:'Y-m-d' }}"></td>
                    <td><input type="date" style="cursor:pointer" name="learning_to[]" value="{{ learning.to_date|date:'Y-m-d' }}"></td>
                    <td><input type="number" name="learning_hours[]" value="{{ learning.number_of_hours }}"></td>
                    <td><input type="text" name="learning_type[]" value="{{ learning.type_of_ld }}"></td>
                    <td><input type="text" name="learning_conducted[]" value="{{ learning.conducted_by }}"></td>
                </tr>
                {% empty %}
                <tr>
                    <td><input type="text" name="learning_title[]" placeholder="Title"></td>
                    <td><input type="date" style="cursor:pointer" name="learning_from[]"></td>
                    <td><input type="date" style="cursor:pointer" name="learning_to[]"></td>
                    <td><input type="number" name="learning_hours[]" placeholder="Number of Hours"></td>
                    <td><input type="text" name="learning_type[]" placeholder="Type of LD"></td>
                    <td><input type="text" name="learning_conducted[]" placeholder="Conducted/Sponsored By"></td>
                </tr>
                {% endfor %}
                
            </tbody>
        </table>
        <button type="button" class="add-row-btn" onclick="addLearningDevelopmentRow()">Add Row</button>
        
        

        <div class="form-actions">
            <button type="submit" class="submit-btn">Save Changes</button>
            {% if creating %}
                <a href="{% url 'home' %}" class="cancel-btn">Cancel</a>  
            {% else %}
                <a href="{% url 'all_forms' form_instance.id %}" class="cancel-btn">Cancel</a>  
            {% endif %}
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('general-form');
    
    const mobileInput = document.querySelector('input[name="mobile_no"]');
    if (mobileInput) {
        mobileInput.addEventListener('blur', function() {
            const value = this.value.trim();
            if (value && !isValidPhilippineMobile(value)) {
                showError(this, 'Invalid Philippine mobile number (e.g., 09171234567)');
            } else {
                clearError(this);
            }
        });
    }
    
    const emailInput = document.querySelector('input[name="email_address"]');
    if (emailInput) {
        emailInput.addEventListener('blur', function() {
            const value = this.value.trim();
            if (value && !isValidEmail(value)) {
                showError(this, 'Invalid email address');
            } else {
                clearError(this);
            }
        });
    }
    
    const zipInputs = document.querySelectorAll('input[name="residential_zip_code"], input[name="permanent_zip_code"]');
    zipInputs.forEach(input => {
        input.addEventListener('blur', function() {
            const value = this.value.trim();
            if (value && !isValidPHZip(value)) {
                showError(this, 'ZIP code must be exactly 4 digits');
            } else {
                clearError(this);
            }
        });
    });
    
    const dobInput = document.querySelector('input[name="date_of_birth"]');
    if (dobInput) {
        dobInput.addEventListener('change', function() {
            const value = this.value;
            if (value) {
                const birthDate = new Date(value);
                const today = new Date();
                const age = today.getFullYear() - birthDate.getFullYear();
                
                if (birthDate > today) {
                    showError(this, 'Birth date cannot be in the future');
                } else if (age < 15) {
                    showError(this, 'Must be at least 15 years old');
                } else if (age > 120) {
                    showError(this, 'Invalid birth date');
                } else {
                    clearError(this);
                }
            }
        });
    }
    
    const tinInput = document.querySelector('input[name="tin_no"]');
    if (tinInput) {
        tinInput.addEventListener('blur', function() {
            const value = this.value.replace(/[\s\-]/g, '');
            if (value && !/^\d{9,12}$/.test(value)) {
                showError(this, 'Invalid TIN (must be 9-12 digits)');
            } else {
                clearError(this);
            }
        });
    }
    
    const sssInput = document.querySelector('input[name="sss_no"]');
    if (sssInput) {
        sssInput.addEventListener('blur', function() {
            const value = this.value.replace(/[\s\-]/g, '');
            if (value && !/^\d{10}$/.test(value)) {
                showError(this, 'Invalid SSS number (must be 10 digits)');
            } else {
                clearError(this);
            }
        });
    }
    
    const philhealthInput = document.querySelector('input[name="philhealth"]');
    if (philhealthInput) {
        philhealthInput.addEventListener('blur', function() {
            const value = this.value.replace(/[\s\-]/g, '');
            if (value && !/^\d{12}$/.test(value)) {
                showError(this, 'Invalid PhilHealth number (must be 12 digits)');
            } else {
                clearError(this);
            }
        });
    }
    
    const heightInput = document.querySelector('input[name="height"]');
    if (heightInput) {
        heightInput.addEventListener('blur', function() {
            const value = parseFloat(this.value);
            if (value && (value < 50 || value > 300)) {
                showError(this, 'Height must be between 50 and 300 cm');
            } else {
                clearError(this);
            }
        });
    }
    
    const weightInput = document.querySelector('input[name="weight"]');
    if (weightInput) {
        weightInput.addEventListener('blur', function() {
            const value = parseFloat(this.value);
            if (value && (value < 20 || value > 300)) {
                showError(this, 'Weight must be between 20 and 300 kg');
            } else {
                clearError(this);
            }
        });
    }
    
    document.querySelectorAll('input[name="rating[]"]').forEach(input => {
        input.addEventListener('blur', function() {
            const value = parseFloat(this.value);
            if (value && (value < 0 || value > 100)) {
                showError(this, 'Rating must be between 0 and 100');
            } else {
                clearError(this);
            }
        });
    });
    
    validateDateRanges('work_from_date[]', 'work_to_date[]');
    validateDateRanges('voluntary_from[]', 'voluntary_to[]');
    validateDateRanges('learning_from[]', 'learning_to[]');
    
    form.addEventListener('submit', function(e) {
        const errors = document.querySelectorAll('.field-error');
        if (errors.length > 0) {
            e.preventDefault();
            alert('Please fix all validation errors before submitting');
            errors[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    });
});

function isValidPhilippineMobile(value) {
    const cleaned = value.replace(/[\s\-\(\)]/g, '');
    return /^(\+63|0)?9\d{9}$/.test(cleaned);
}

function isValidEmail(value) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
}

function isValidPHZip(value) {
    return /^\d{4}$/.test(value);
}

function validateDateRanges(fromName, toName) {
    const fromInputs = document.querySelectorAll(`input[name="${fromName}"]`);
    const toInputs = document.querySelectorAll(`input[name="${toName}"]`);
    
    fromInputs.forEach((fromInput, index) => {
        const toInput = toInputs[index];
        if (!toInput) return;
        
        const validate = () => {
            const fromDate = new Date(fromInput.value);
            const toDate = new Date(toInput.value);
            
            if (fromInput.value && toInput.value && fromDate > toDate) {
                showError(toInput, 'End date must be after start date');
            } else {
                clearError(toInput);
            }
        };
        
        fromInput.addEventListener('change', validate);
        toInput.addEventListener('change', validate);
    });
}

function showError(input, message) {
    clearError(input);
    
    input.classList.add('invalid-input');
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'field-error';
    errorDiv.textContent = message;
    errorDiv.style.color = '#dc3545';
    errorDiv.style.fontSize = '0.85em';
    errorDiv.style.marginTop = '4px';
    
    input.parentNode.appendChild(errorDiv);
}

function clearError(input) {
    input.classList.remove('invalid-input');
    
    const existingError = input.parentNode.querySelector('.field-error');
    if (existingError) {
        existingError.remove();
    }
}
</script>


<!-- //for photo -->
 <script>
function previewPhoto(event) {
    const file = event.target.files[0];
    
    if (!file) return;
    
    if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB');
        event.target.value = '';
        return;
    }
    
    if (!['image/jpeg', 'image/jpg', 'image/png'].includes(file.type)) {
        alert('Only JPG and PNG files are allowed');
        event.target.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const preview = document.getElementById('photoPreview');
        const placeholder = document.getElementById('photoPlaceholder');
        
        preview.src = e.target.result;
        preview.style.display = 'block';
        
        if (placeholder) {
            placeholder.style.display = 'none';
        }
        
        if (!document.querySelector('.photo-actions')) {
            const actions = document.createElement('div');
            actions.className = 'photo-actions';
            actions.innerHTML = `
                <button type="button" class="btn-change-photo" onclick="document.getElementById('id_photo_input').click()">
                    Change Photo
                </button>
                <button type="button" class="btn-remove-photo" onclick="removePhoto()">
                    Remove Photo
                </button>
            `;
            preview.parentNode.appendChild(actions);
        }
    };
    reader.readAsDataURL(file);
}

function removePhoto() {
    if (!confirm('Are you sure you want to remove the photo?')) {
        return;
    }
    
    document.getElementById('remove_photo_input').value = 'true';
    document.getElementById('id_photo_input').value = '';
    
    const preview = document.getElementById('photoPreview');
    const placeholder = document.getElementById('photoPlaceholder');
    const actions = document.querySelector('.photo-actions');
    
    preview.style.display = 'none';
    preview.src = '';
    
    if (placeholder) {
        placeholder.style.display = 'flex';
    }
    
    if (actions) {
        actions.remove();
    }
    
    document.getElementById('general-form').submit();
}
</script>
<style>
.id-photo-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    align-items: start;
}

.photo-preview {
    text-align: center;
}

.id-photo-img {
    width: 250px;
    height: 250px;
    object-fit: cover;
    border: 3px solid #ddd;
    border-radius: 8px;
    display: block;
    margin: 0 auto 15px;
}

.photo-placeholder {
    width: 250px;
    height: 250px;
    border: 3px dashed #ddd;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0 auto 15px;
    background: #f8f9fa;
}

.photo-placeholder p {
    color: #999;
    margin: 10px 0;
}

.photo-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.btn-upload-photo,
.btn-change-photo,
.btn-remove-photo {
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.9em;
    transition: all 0.3s;
}

.btn-upload-photo,
.btn-change-photo {
    background: #007BFF;
    color: white;
}

.btn-upload-photo:hover,
.btn-change-photo:hover {
    background: #0056b3;
}

.btn-remove-photo {
    background: #dc3545;
    color: white;
}

.btn-remove-photo:hover {
    background: #c82333;
}

.photo-info {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #ddd;
}

.photo-info ul {
    margin: 10px 0;
    padding-left: 20px;
}

.photo-info li {
    margin-bottom: 8px;
    color: #666;
}

</style>



<style>
.invalid-input {
    border-color: #dc3545 !important;
    background-color: #fff5f5 !important;
}

.field-error {
    color: #dc3545;
    font-size: 0.85em;
    margin-top: 4px;
    font-weight: 500;
}
</style>
{% endblock %}