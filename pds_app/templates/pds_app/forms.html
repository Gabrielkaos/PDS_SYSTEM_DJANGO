{% extends 'pds_app/home.html' %}

{% block sidebar %}
<div id="attendanceModal" class="modal" style="display: none;">
    <span id="closeModalBtn" class="close">
        <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="#fff"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
    </span>

    <div class="file-upload-content">
        <h2>Upload File</h2>
        <form method="post" enctype="multipart/form-data" action="{% url 'import_form' %}">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Upload</button>
        </form>
    </div>
</div>

<div class="forms-header">
    <h3>Your Forms</h3>
    <p class="forms-count">{{ forms|length }} form{{ forms|pluralize }}</p>
</div>

<div class="search-section">
    <a href="{% url 'create_form' %}" hidden id="hidden_a" style="margin: -10px;"></a>
    <form method="get" action="{% url 'home' %}" id="form-search">
        <input 
            type="text" 
            name="search" 
            value="{{ search_query }}" 
            placeholder="Search by personal info"
        >
        <button type="submit">
            Search
        </button>
        {% if search_query %}
        <button type="button" id="button_clear">
            Clear
        </button>
        {% endif %}
    </form>
    
    {% if search_query %}
    <p>
        {{ total_forms }} result{{ total_forms|pluralize }} for "{{ search_query }}"
    </p>
    {% endif %}
</div>

<div class="forms-list">
    {% for form in forms %}
        <div class="form-item" id="mainFormLink">
            <a href="{% url 'all_forms' form.id %}" class="form-link" id="mainLink">
                <div class="form-name">{{ form.name }}</div>
                <div class="form-date">Created: {{ form.created_at|date:"M d, Y" }}</div>
                <div class="form-date">Updated: {{ form.updated_at|date:"M d, Y" }}</div>
            </a>
            
            <form method="post" action="{% url 'delete_form' form.id %}" class="delete-form">
                {% csrf_token %}
                <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete {{ form.name }}?');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                    </svg>
                </button>
            </form>
        </div>
    {% endfor %}
        <div class="form-item" id="createNewLink">
            <a href="{% url 'create_form'  %}" class="form-link" id="createFormLink">
                <div class="form-name">Create New</div>
            </a>
            <button class="add-btn" id="createFormButton" type="button">
                <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="#e3e3e3"><path d="M440-80v-340H120v-120h320v-340h80v340h320v120H520v340h-80Z"/></svg>                
            </button>
        </div>
        <div class="form-item" id="clickableFormItem">
            <a>
                <div class="form-name">Import Form</div>
            </a>
            <button id="openModalBtn" type="button" class="open-modal-button" hidden>
                
            </button>
        </div>
</div>

<script>

    const button_clear = document.getElementById("button_clear")

    button_clear.addEventListener("click",()=>{
        window.location = document.getElementById("hidden_a").href
    })
</script>

<script>
  document.getElementById('createFormButton').addEventListener('click', function() {
    window.location = document.getElementById("createFormLink").href;
  });
  document.getElementById('createNewLink').addEventListener('click', function() {
    window.location = document.getElementById("createFormLink").href;
  });
  document.getElementById('mainFormLink').addEventListener('click', function() {
    window.location = document.getElementById("mainLink").href;
  });
</script>

<script>
    const form_item = document.getElementById('clickableFormItem')
    const open_modal_button = document.getElementById('openModalBtn')

    form_item.addEventListener("click",(event)=>{
        if(event.target !== open_modal_button){
            open_modal_button.click()
        }
    })
</script>

{% endblock sidebar %}

{% block content %}
{% endblock content %}